<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Sync Integration Dashboard</title>
    <style>
        :root {
            color-scheme: light;
        }
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            background: #f5f7fb;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            color: #1f2933;
            line-height: 1.5;
        }
        .page {
            max-width: 1100px;
            margin: 0 auto;
            padding: 32px 20px 48px;
        }
        .header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 28px;
        }
        .header h1 {
            margin: 0;
            font-size: 28px;
            color: #1d3557;
        }
        .header p {
            margin: 8px 0 0;
            max-width: 620px;
            color: #52606d;
        }
        .status-group {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
            min-width: 220px;
        }
        .status-chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 999px;
            font-size: 14px;
            transition: background 0.25s ease, color 0.25s ease;
        }
        .status-idle {
            background: #e2e8f0;
            color: #475569;
        }
        .status-progress {
            background: #dbeafe;
            color: #1d4ed8;
        }
        .status-connected {
            background: #dcfce7;
            color: #166534;
        }
        .status-error {
            background: #fee2e2;
            color: #b91c1c;
        }
        .status-subtitle {
            font-size: 13px;
            color: #64748b;
            text-align: right;
        }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }
        .card {
            background: #ffffff;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 14px 35px rgba(15, 23, 42, 0.08);
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .card h2 {
            margin: 0;
            font-size: 20px;
            color: #1d3557;
        }
        label {
            font-size: 14px;
            font-weight: 600;
            color: #52606d;
        }
        input[type="text"],
        input[type="password"],
        select,
        textarea {
            width: 100%;
            padding: 12px 14px;
            border-radius: 10px;
            border: 1px solid #d9e2ec;
            background: #f8fafc;
            font-size: 15px;
            font-family: inherit;
            transition: border-color 0.2s ease, background 0.2s ease;
        }
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #2563eb;
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.14);
        }
        .field-helper {
            font-size: 12px;
            color: #94a3b8;
        }
        .scope-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .scope-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            background: #f8fafc;
        }
        .scope-item span {
            font-weight: 500;
            color: #1f2933;
        }
        .scope-item small {
            display: block;
            font-size: 12px;
            color: #64748b;
        }
        .scope-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #2563eb;
        }
        .button-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        button {
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s ease, box-shadow 0.2s ease;
        }
        button:active {
            transform: translateY(1px);
        }
        button.primary {
            background: linear-gradient(135deg, #2563eb, #3b82f6);
            color: #ffffff;
            box-shadow: 0 12px 24px rgba(37, 99, 235, 0.25);
        }
        button.secondary {
            background: #e0e7ff;
            color: #1d4ed8;
        }
        button.ghost {
            background: #f1f5f9;
            color: #475569;
        }
        button:disabled {
            opacity: 0.6;
            cursor: default;
            box-shadow: none;
            transform: none;
        }
        .status-card {
            display: grid;
            gap: 12px;
        }
        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 999px;
            background: #f1f5f9;
            color: #475569;
            font-size: 13px;
        }
        .status-values {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            color: #334155;
            font-weight: 500;
        }
        .next-sync {
            font-size: 13px;
            color: #64748b;
        }
        .toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }
        .switch {
            position: relative;
            width: 46px;
            height: 26px;
        }
        .switch input {
            appearance: none;
            width: 100%;
            height: 100%;
            margin: 0;
        }
        .switch span {
            position: absolute;
            inset: 0;
            background: #cbd5e1;
            border-radius: 999px;
            transition: background 0.2s ease;
        }
        .switch span::after {
            content: "";
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffffff;
            box-shadow: 0 2px 6px rgba(15, 23, 42, 0.2);
            transition: transform 0.2s ease;
        }
        .switch input:checked + span {
            background: #2563eb;
        }
        .switch input:checked + span::after {
            transform: translateX(20px);
        }
        .log-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 14px;
            max-height: 290px;
            overflow-y: auto;
        }
        .log-entry {
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 14px 16px;
            background: #f8fafc;
        }
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
            font-size: 13px;
            color: #64748b;
        }
        .log-tag {
            padding: 4px 10px;
            border-radius: 999px;
            font-weight: 600;
        }
        .log-tag.info {
            background: #e0e7ff;
            color: #3730a3;
        }
        .log-tag.success {
            background: #dcfce7;
            color: #166534;
        }
        .log-tag.error {
            background: #fee2e2;
            color: #b91c1c;
        }
        .empty-state {
            text-align: center;
            padding: 28px 16px;
            color: #94a3b8;
            font-size: 14px;
            border: 1px dashed #cbd5e1;
            border-radius: 12px;
            background: #f8fafc;
        }
        @media (max-width: 640px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            .status-group {
                align-items: flex-start;
                min-width: unset;
            }
            .status-subtitle {
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <div class="page">
        <header class="header">
            <div>
                <h1>Auth Sync Integration</h1>
                <p>Configure your identity provider connection, choose what to synchronize, and monitor progress as we bring your authentication data into alignment.</p>
            </div>
            <div class="status-group">
                <span id="connectionStatus" class="status-chip status-idle">Status: Idle</span>
                <span id="statusSubtitle" class="status-subtitle">No connection tested yet.</span>
            </div>
        </header>

        <div class="card-grid">
            <section class="card">
                <h2>Connection Settings</h2>
                <div>
                    <label for="serviceUrl">Service URL</label>
                    <input id="serviceUrl" type="text" placeholder="https://auth.example.com/api" autocomplete="off">
                    <div class="field-helper">Use the base URL for your identity provider or sync broker.</div>
                </div>
                <div>
                    <label for="apiKey">API Key</label>
                    <input id="apiKey" type="password" placeholder="••••••••••" autocomplete="new-password">
                    <div class="field-helper">The key should allow read/write access to the selected scopes.</div>
                </div>
                <div>
                    <label for="environmentSelect">Environment</label>
                    <select id="environmentSelect">
                        <option value="staging">Staging</option>
                        <option value="production">Production</option>
                        <option value="development">Development</option>
                    </select>
                </div>
            </section>

            <section class="card">
                <h2>Sync Controls</h2>
                <div class="scope-list">
                    <label class="scope-item">
                        <div>
                            <span>Users</span>
                            <small>Personal profiles, MFA preferences, and primary identifiers.</small>
                        </div>
                        <input type="checkbox" data-scope="users">
                    </label>
                    <label class="scope-item">
                        <div>
                            <span>Groups & Teams</span>
                            <small>Team memberships, organizational units, and roles.</small>
                        </div>
                        <input type="checkbox" data-scope="groups">
                    </label>
                    <label class="scope-item">
                        <div>
                            <span>Permissions</span>
                            <small>Fine-grained entitlements mapped to products and services.</small>
                        </div>
                        <input type="checkbox" data-scope="permissions">
                    </label>
                </div>
                <div class="button-row">
                    <button id="testConnection" class="secondary">Test Connection</button>
                    <button id="syncNow" class="primary">Sync Now</button>
                    <button id="clearLogs" class="ghost">Clear Logs</button>
                </div>
            </section>

            <section class="card status-card">
                <h2>Sync Status</h2>
                <div class="status-values">
                    <div>
                        <div class="field-helper">Last Sync</div>
                        <div id="lastSyncValue">No sync activity recorded yet.</div>
                    </div>
                    <div>
                        <div class="field-helper">Triggered By</div>
                        <div id="lastSyncSource">Not available</div>
                    </div>
                </div>
                <div class="toggle">
                    <div>
                        <div>Automatic sync</div>
                        <div class="next-sync" id="nextSyncInfo">Auto sync is disabled.</div>
                    </div>
                    <label class="switch">
                        <input id="autoSyncToggle" type="checkbox">
                        <span></span>
                    </label>
                </div>
            </section>

            <section class="card" style="grid-column: 1 / -1;">
                <h2>Activity Log</h2>
                <div id="logEmptyState" class="empty-state">Actions will appear here once you start testing or syncing.</div>
                <ul id="activityLog" class="log-list"></ul>
            </section>
        </div>
    </div>

    <script>
        (function() {
            const storageKey = "authSyncSettings";
            const AUTO_SYNC_MS = 30000;
            const statusBadge = document.getElementById("connectionStatus");
            const statusSubtitle = document.getElementById("statusSubtitle");
            const urlInput = document.getElementById("serviceUrl");
            const apiKeyInput = document.getElementById("apiKey");
            const envSelect = document.getElementById("environmentSelect");
            const scopeInputs = Array.from(document.querySelectorAll('[data-scope]'));
            const testBtn = document.getElementById("testConnection");
            const syncBtn = document.getElementById("syncNow");
            const clearBtn = document.getElementById("clearLogs");
            const lastSyncValue = document.getElementById("lastSyncValue");
            const lastSyncSource = document.getElementById("lastSyncSource");
            const autoToggle = document.getElementById("autoSyncToggle");
            const nextSyncInfo = document.getElementById("nextSyncInfo");
            const logList = document.getElementById("activityLog");
            const emptyState = document.getElementById("logEmptyState");

            let autoSyncTimeout = null;
            let countdownInterval = null;
            let nextScheduledSync = null;

            const defaultSettings = {
                url: "",
                apiKey: "",
                environment: "staging",
                scopes: {
                    users: true,
                    groups: true,
                    permissions: false
                },
                autoSync: false,
                lastSync: null,
                lastSyncSource: null
            };

            let settings = loadSettings();
            applySettings();
            if (settings.lastSync) {
                updateStatus("connected", "Ready for the next sync run.");
            } else {
                updateStatus("idle", "No connection tested yet.");
            }

            urlInput.addEventListener("input", () => {
                settings.url = urlInput.value.trim();
                persistSettings();
            });

            apiKeyInput.addEventListener("input", () => {
                settings.apiKey = apiKeyInput.value.trim();
                persistSettings();
            });

            envSelect.addEventListener("change", () => {
                settings.environment = envSelect.value;
                addLog("info", `Environment changed to ${pretty(settings.environment)}.`);
                persistSettings();
            });

            scopeInputs.forEach(input => {
                input.addEventListener("change", () => {
                    settings.scopes[input.dataset.scope] = input.checked;
                    addLog("info", `${input.dataset.scope.charAt(0).toUpperCase()}${input.dataset.scope.slice(1)} scope ${input.checked ? "enabled" : "disabled"}.`);
                    persistSettings();
                });
            });

            autoToggle.addEventListener("change", () => {
                if (autoToggle.checked) {
                    settings.autoSync = true;
                    persistSettings();
                    addLog("info", "Automatic sync enabled.");
                    scheduleAutoSync();
                } else {
                    settings.autoSync = false;
                    persistSettings();
                    addLog("info", "Automatic sync disabled.");
                    clearAutoSync();
                    nextSyncInfo.textContent = "Auto sync is disabled.";
                }
            });

            testBtn.addEventListener("click", async () => {
                if (!settings.url || !settings.apiKey) {
                    updateStatus("error", "Provide both a service URL and API key to test the connection.");
                    addLog("error", "Connection test failed: missing credentials.");
                    return;
                }

                disableControls(true);
                updateStatus("progress", "Testing connection...");
                addLog("info", `Testing connection against ${settings.url} (${pretty(settings.environment)}).`);
                await wait(900);

                const success = settings.url.startsWith("http");
                if (success) {
                    updateStatus("connected", "Connection validated successfully.");
                    addLog("success", "Connection test succeeded. Credentials accepted.");
                } else {
                    updateStatus("error", "Connection test failed. Check the service URL.");
                    addLog("error", "Connection test failed: invalid URL format.");
                }
                disableControls(false);
            });

            syncBtn.addEventListener("click", () => triggerSync("Manual"));
            clearBtn.addEventListener("click", clearLogs);

            function disableControls(disabled) {
                testBtn.disabled = disabled;
                syncBtn.disabled = disabled;
                autoToggle.disabled = disabled;
            }

            function loadSettings() {
                try {
                    const stored = localStorage.getItem(storageKey);
                    if (stored) {
                        const parsed = JSON.parse(stored);
                        return {
                            ...defaultSettings,
                            ...parsed,
                            scopes: { ...defaultSettings.scopes, ...(parsed.scopes || {}) }
                        };
                    }
                } catch (err) {
                    console.error("Failed to parse stored settings", err);
                }
                return { ...defaultSettings };
            }

            function persistSettings() {
                localStorage.setItem(storageKey, JSON.stringify(settings));
            }

            function applySettings() {
                urlInput.value = settings.url;
                apiKeyInput.value = settings.apiKey;
                envSelect.value = settings.environment;
                scopeInputs.forEach(input => {
                    input.checked = Boolean(settings.scopes[input.dataset.scope]);
                });
                autoToggle.checked = Boolean(settings.autoSync);
                updateLastSyncDisplay();
                if (settings.autoSync) {
                    scheduleAutoSync();
                }
            }

            function updateStatus(state, message) {
                statusBadge.classList.remove("status-idle", "status-progress", "status-connected", "status-error");
                const stateMap = {
                    idle: "status-idle",
                    progress: "status-progress",
                    connected: "status-connected",
                    error: "status-error"
                };
                statusBadge.classList.add(stateMap[state] || "status-idle");
                statusBadge.textContent = `Status: ${stateLabel(state)}`;
                statusSubtitle.textContent = message;
            }

            function stateLabel(state) {
                switch (state) {
                    case "progress":
                        return "In Progress";
                    case "connected":
                        return "Connected";
                    case "error":
                        return "Attention";
                    default:
                        return "Idle";
                }
            }

            function updateLastSyncDisplay() {
                if (!settings.lastSync) {
                    lastSyncValue.textContent = "No sync activity recorded yet.";
                    lastSyncSource.textContent = "Not available";
                    return;
                }
                const date = new Date(settings.lastSync);
                lastSyncValue.textContent = new Intl.DateTimeFormat(undefined, {
                    dateStyle: "medium",
                    timeStyle: "short"
                }).format(date);
                const sourceLabel = settings.lastSyncSource ? pretty(settings.lastSyncSource) : "Manual";
                lastSyncSource.textContent = `${sourceLabel} trigger`;
            }

            function pretty(value) {
                return value.charAt(0).toUpperCase() + value.slice(1);
            }

            function wait(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            function addLog(type, message) {
                const entry = document.createElement("li");
                entry.className = "log-entry";
                const timeStamp = new Intl.DateTimeFormat(undefined, {
                    hour: "2-digit",
                    minute: "2-digit",
                    second: "2-digit"
                }).format(new Date());
                entry.innerHTML = `
                    <div class="log-header">
                        <span>${timeStamp}</span>
                        <span class="log-tag ${type}">${pretty(type)}</span>
                    </div>
                    <div>${message}</div>
                `;
                logList.appendChild(entry);
                emptyState.style.display = "none";
                while (logList.children.length > 40) {
                    logList.removeChild(logList.firstChild);
                }
                logList.scrollTop = logList.scrollHeight;
            }

            function clearLogs() {
                logList.innerHTML = "";
                emptyState.style.display = "block";
            }

            function selectedScopes() {
                return scopeInputs
                    .filter(input => input.checked)
                    .map(input => input.dataset.scope);
            }

            async function triggerSync(source) {
                if (!settings.url || !settings.apiKey) {
                    updateStatus("error", "Add a service URL and API key before starting a sync.");
                    addLog("error", "Sync aborted: missing credentials.");
                    return false;
                }

                const scopes = selectedScopes();
                if (!scopes.length) {
                    updateStatus("error", "Select at least one scope to synchronize.");
                    addLog("error", "Sync aborted: no scopes selected.");
                    return false;
                }

                disableControls(true);
                updateStatus("progress", `${source} sync in progress...`);
                addLog("info", `${source} sync started for ${scopes.map(pretty).join(", ")} (${pretty(settings.environment)}).`);

                try {
                    await wait(600);
                    for (const scope of scopes) {
                        await wait(450);
                        addLog("success", `${pretty(scope)} data synchronized successfully.`);
                    }
                    await wait(350);
                    settings.lastSync = new Date().toISOString();
                    settings.lastSyncSource = source.toLowerCase();
                    persistSettings();
                    updateLastSyncDisplay();
                    updateStatus("connected", `${source} sync completed without issues.`);
                    addLog("success", `${source} sync completed.`);
                    return true;
                } catch (err) {
                    updateStatus("error", "Sync failed. Review logs and try again.");
                    addLog("error", "Sync failed due to an unexpected error.");
                    return false;
                } finally {
                    disableControls(false);
                }
            }

            function scheduleAutoSync() {
                clearAutoSync();
                nextScheduledSync = Date.now() + AUTO_SYNC_MS;
                updateNextSyncLabel();
                countdownInterval = setInterval(updateNextSyncLabel, 1000);
                autoSyncTimeout = setTimeout(async function handleAutoSync() {
                    updateNextSyncLabel(true);
                    const success = await triggerSync("Auto");
                    if (!settings.autoSync) {
                        return;
                    }
                    if (!success) {
                        addLog("error", "Auto sync stopped due to missing prerequisites.");
                        settings.autoSync = false;
                        persistSettings();
                        autoToggle.checked = false;
                        nextSyncInfo.textContent = "Auto sync stopped. Resolve issues to restart.";
                        clearAutoSync();
                        return;
                    }
                    nextScheduledSync = Date.now() + AUTO_SYNC_MS;
                    updateNextSyncLabel();
                    autoSyncTimeout = setTimeout(handleAutoSync, AUTO_SYNC_MS);
                }, AUTO_SYNC_MS);
            }

            function updateNextSyncLabel(running) {
                if (!settings.autoSync) {
                    nextSyncInfo.textContent = "Auto sync is disabled.";
                    return;
                }
                if (running) {
                    nextSyncInfo.textContent = "Auto sync running now...";
                    return;
                }
                const diff = nextScheduledSync - Date.now();
                if (diff <= 0) {
                    nextSyncInfo.textContent = "Next auto sync starting...";
                    return;
                }
                const seconds = Math.ceil(diff / 1000);
                nextSyncInfo.textContent = `Next auto sync in ${seconds}s`;
            }

            function clearAutoSync() {
                if (autoSyncTimeout) {
                    clearTimeout(autoSyncTimeout);
                    autoSyncTimeout = null;
                }
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                    countdownInterval = null;
                }
                nextScheduledSync = null;
            }
        })();
    </script>
</body>
</html>
